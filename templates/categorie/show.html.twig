{% extends 'base.html.twig' %}

{% block title %}{{categorie}} Topics - Forum - Walk&Train{% endblock %}
{% block meta_description %}
    <meta name="description" content="Welcome to the Dog Project Forum, a community for all dog lovers to discuss anything related to man's best friend. This is the "{{categorie}}" category">
    <meta name="keywords" content="dog project, dog, dog trainers near me, local dog trainers, dog walks near me, dog owners community, forum">
{% endblock %}

{% block body %}   

    
    <main class="category-main">


            <div class="category-menu" id="category-page-menu">
                {% for categorie in categories %}
                    {% if (categorie.nom != 'Walks') and (categorie.nom != 'Sessions') %}
                        <a href="{{ path('show_categorie', {'id': categorie.id}) }}"><i class="fa-solid fa-bars"></i> {{ categorie }}</a>
                    {% endif %}
                {% endfor %}
            </div>

        
        
        <div class="category-name">
            <div class="breadcrumbs">
                <a href="{{ path('app_home') }}">Home</a> >> 
                <a href="{{ path('app_categorie') }}">Forum</a>          
            </div>
            <h4>{{categorie}}</h4>
        </div>

        <div>
            
                <h5 class="topic-topic">Topics</h5>
                
                <div class="category-topics">
                    {% if categorie.topics is empty %}
            <h2 style="text-align: center;">No topics yet, be the first</h2>
        {% else %}

                    {% for topic in categorie.topics | sort((a, b) => b.dateCreation <=> a.dateCreation) %}
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="card" style="margin-left: 7px;">
                                    
                                    <div class="card-body">
                                        <div class="topic-content">
                                        <div class="topic-info">
                                            <a href="{{ path('show_topic', {'id': topic.id}) }}" aria-label="go to topic's page"><p>{{topic}}</p></a>
                                            {% if topic.auteur is empty %}
                                                <p>by deleted user</p>
                                            {% else %}
                                            by<a href="{{ path('show_personne', {'id': topic.auteur.id}) }}" aria-label="{{ "go to " ~ topic.auteur ~ "'s profile page" }}">
                                                     {{topic.auteur}}
                                                </a>
                                            {% endif %}
                                        </div>
                                        <div class="topic-posts">
                                            {# <div class="bubble">
                                                <div class="bubble-text">
                                                    
                                                </div>
                                            </div> #}
                                            {{ nbPostsParTopic[topic.id] }} post(s)
                                        </div>

                                        <div class="topic-last-post">
                                            <div>
                                            <p class="text-muted small">Last post by</p>
                                            {% set lastPost = lastPostParTopic[topic.id] %}
                                            
                                            {% if lastPost is empty %}
                                                
                                            {% else %}
                                            {% set latestPost = lastPost[0] %}
                                                <div>
                                                    <a href="{{ path('show_personne', {'id': latestPost.auteur.id}) }}" aria-label="{{ "go to " ~ latestPost.auteur ~ "'s profile page" }}">
                                                        <img class="topic-picture" src="{{ asset('/images/users/' ~ latestPost.auteur.nomImageProfil) }}" alt="{{ latestPost.auteur ~ "'s profile picture" }}">
                                                    </a>
                                                </div>
                                                <div class="text-muted small"> 
                                                    {{ latestPost.auteur }}
                                                    {{latestPost.dateCreation | date('d-m-Y H:i:s')}}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                </div>
                                                      
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    {% endif %}
                </div>
        </div>
    
        <div class="topic">
            <div class="topic-date">
                <p></p>
            </div>   
            
            <div class="topic-body">         
                <div class="topic-user" id="topicUserForm">
                    <span><img class="topic-picture" src="{{ asset('/images/users/' ~ app.user.nomImageProfil) }}" alt="your profile picture"></span>
                    <span>{{app.user}}</span> 
                </div>
    
                <form method="post" id="new-post-form" class="topic-content">
                    {{ form_start(formAddTopic) }}
                        {{ form_widget(formAddTopic.titre, {'attr': {'placeholder': 'Topic Title'}}) }}
                        {{ form_widget(formAddTopic.submit) }}
                    {{ form_end(formAddTopic) }}
                </form>
            </div>
        </div>
    
        </div>
    </main>
    

{% endblock %}